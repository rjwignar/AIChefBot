
## Installation

This document gives an overview of how to install a working version of AIChefBot to a local repository, as well as detailing the deployment process to [Vercel](https://vercel.com/).

### Contents
- [Local Install](#installation)
- [Environment Variables](#Environment_Variables)
- [Deployment](#Deployment)

<hr>

### Installation

Set up a local development repository, clone the source repository via SSH.

```bash 
$ git clone git@github.com:rjwignar/AIChefBot.git
```

Navigate to the source directory.

```bash
$ cd AIChefBot
```

Install packages using NPM (this may take a minute).
```
$ npm install
```

### Environment Variables

Before a working version of AIChefBot can be run in a local repository, one must acquire and set environment variables.

```touch .env```

See an example of the `.env` file [here](./.env_example)

### Getting your keys

#### 1. OpenAI

[Sign up to OpenAI](https://platform.openai.com/signup)

- From the sidebar, find the **API Keys** section.
- Click **Create new secret key**
- Give your key a name
- Copy your key into `.env` and replace `YOUR_OPENAI_API_KEY` with your new API key.

From here, you'll have to manage your funds. From the sidebar, navigate to **usage**, and put some funds in your account to use our OpenAI's models to generate your own recipes and images.


#### 2. MongoDB Atlas

[Sign up to MongoDB Atlas](https://www.mongodb.com/atlas)

- Click **Create a deployment**
- Choose the cluster you'd like to use. The free version is **M0**.
- Give your cluster a name, such as **yourname_AIChefBot**.
- Copy your **Username** and **Password**, these will be used as your *administrator* values in your `.env_example` file.
- Copy your **Username** value in to the `.env` file and replace `YOUR_MONGODB_ATLAS_ADMIN_NAME`.
- Copy your **Password** value in to the `.env` file and replace `YOUR_MONGODB_ATLAS_PASSWORD`.
- Delete the **users** database, to be replaced by AIChefBot's **users** database.

#### 3. Cloudinary
[Cloudinary](https://cloudinary.com/) is the image hosting service used to store and manage recipe images generated by OpenAI's [DALL-E 2](https://openai.com/dall-e-2).
To create and manage recipe images with your own **Cloudinary Product Environment**, [create a free Cloudinary account](https://cloudinary.com/users/register_free)

- After logging in, navigate to the **Getting Started Page** either by left-click **"Getting Started"** on the console or by navigating to https://console.cloudinary.com/pm/getting-started.
- In the **Getting Started Page**, left-click the **"View Credentials"** button to open the **Product Environment Credentials** modal.
- The **Product Environment Credentials** modal shows the credentials required to connect and interact with your own Cloudinary Product Environment.
- In the **Product Environment Credentials** modal you will see the following credentials that must be copied and pasted into your `.env` file:

| .env Variable Name |  Cloudinary Product Environment Credential Name |
| --- | --- |
| **NEXT_PUBLIC_CLOUDINARY_API_KEY** | API key |
| **CLOUDINARY_API_SECRET** | API secret |
| **CLOUDINARY_CLOUD_NAME** | Cloud name |

- Copy your API key into the `.env` file, replacing `YOUR_CLOUDINARY_API_KEY`
- Copy your API secret into the `.env` file, replacing `YOUR_CLOUDINARY_API_SECRET`
- Copy your Cloud name into the `.env` file, replacing `YOUR_CLOUDINARY_CLOUD_NAME`

After these steps, you will have created your own **Cloudinary Product Environment** and added the environment variables required to connect to it.

#### 4. AWS Cognito

1. You will have to create a AWS Account [Sign up to AWS](https://aws.amazon.com/console/) 
2. When you are at console home search **Cognito**
3. Click **Create user pool**

### Step 1: Configure sign-in experience
1. Select the options **User name, Email**

### Step 2: Configure security requirements
1. Make whatever password policy you want or you can leave it default
2. Make sure to select **No MFA** (you can add MFA but will add cost)
3. Make sure **Enable self service account recovery** is checked and use **Email only** (other options have additional cost)

### Step 3: Configure sign-up experience
1. Make sure **Enable self-registration** is selected 
2. Make sure **Keep original attribute value active when an update is pending** is selected
3. In the required attributes dropdown add **name**

### Step 4: Configure message delivery
1. Select **Send email with Cognito** keep the rest default

### Step 5: Integrate your app
1. Give your user pool a name such as `yourname-aichefbot-users`
2. Select **Use the Cognito Hosted UI** 
3. Select **Use a Cognito domain** 
4. Keep **https://** and type in a name. This will be your domain when users log in (avoid using your name here since this will be public)
5. Select **Public client** enter a App client name such as `yourname-aichefbot-app`
6. Select **Don't generate a client secret**
7. Allowed callback URLs (can edit this later) copy and paste `http://localhost:3000/api/auth/callback/cognito`
8. Click the dropdown **Advanced app client settings** scroll down to **OpenID Connect scopes** click the dropdown and add `aws.cognito.signin.user.admin` scope.
9. Click **Add sign-out URL** copy and paste `http://localhost:3000`
  
### Step 6: Review and Create
Double check all the values are correct create your user pool.

### Getting your keys
1. Click on your newly created user pool
2. Copy the **User Pool ID** and replace `YOUR_USER_POOL_ID` inside`.env` 
3. Click the **App integration** tab
4. Copy the **Cognito domain** and replace `YOUR_COGNITO_UI_DOMAIN` inside`.env`
5. Scroll all they way down till you see **App client list**
6. On the **Client ID** tab copy the value and replace `YOUR_COGNITO_CLIENT_ID` inside`.env`

### OAuth Sign-In and Out Redirect URLS, AWS Amazon Cognito Logout Endpoint URL and AWS Amazon Cognito Issuer
these keys are provided for you in the .env_example [here](./env_exmaple) copy them and add to your `.env`

### NextAuthJS secret
generate a secret with
```bash
$ openssl rand -base64 64
```
copy that value and replace `YOUR_NEXTAUTH_SECRET` inside `.env`

Here you will have access to the most recent version of the application. To make changes and contribute, see the [contributing](./CONTRIBUTING.md) document.

### Running the Development Version

```bash
$ npm run dev
```

<br>

Navigate to `http://localhost:3000` in your chosen browser to experience the development version.

<hr>

### Deployment

...
